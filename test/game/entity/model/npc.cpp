#include <gtest/gtest.h>

#include "entity/model/npc.h"
using namespace openao::game::entity;

TEST(entity_model_NPC, Serialization) {

  // SETUP
  NPC npc{};
  npc.id = 2470772920;
  npc.tag = 0;
  npc.position.x = 31;
  npc.position.y = 38;
  npc.name = "Yellow Sand Demo";
  npc.orientation = 0;
  npc.model = 43187;
  npc.faction = 7;
  npc.level = 101;
  npc.type = 8390689;

  // EXECUTE
  BinaryBuffer buffer;
  buffer.write(npc);

  // VALIDATE
  uint8_t expect[] = {0xb8, 0x00, 0x45, 0x93, 0x00, 0x00, 0x00, 0x00, 0x1f,
                      0x00, 0x00, 0x00, 0x26, 0x00, 0x00, 0x00, 0x59, 0x65,
                      0x6c, 0x6c, 0x6f, 0x77, 0x20, 0x53, 0x61, 0x6e, 0x64,
                      0x20, 0x44, 0x65, 0x6d, 0x6f, 0x00, 0x00, 0xb3, 0xa8,
                      0x00, 0x00, 0x07, 0x00, 0x65, 0x00, 0x00, 0x00, 0x00,
                      0x00, 0x21, 0x08, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00,
                      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

  ASSERT_EQ(0, std::memcmp(expect, buffer.data(), sizeof(expect)));
  ASSERT_EQ(sizeof(expect), buffer.size());
}